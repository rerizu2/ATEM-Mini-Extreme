<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ATEM Mini Extreme ISOã€çµ±åˆã‚¢ãƒ‹ãƒ¡å¯¾å¿œç‰ˆã€‘</title>
<style>
body {
  display:flex; justify-content:center; align-items:center; flex-direction:column;
  height:100vh; margin:0; background:black; color:white;
  font-family:sans-serif; overflow:hidden;
}
h1 { margin-top:10px; }
.container {
  display:grid; grid-template-columns:1fr 1fr; grid-template-rows:1fr 1fr;
  width:80vw; height:80vh; border:2px solid white; position:relative;
}
.cell { border:1px solid gray; position:relative; overflow:hidden; }
video { width:100%; height:100%; object-fit:cover; position:absolute; top:0; left:0; }
.label {
  position:absolute; top:5px; left:5px; color:white; font-size:20px;
  background:rgba(0,0,0,0.5); padding:5px; border-radius:5px; z-index:2;
}
.horizontal-line, .vertical-line { position:absolute; background:white; z-index:2; }
.horizontal-line { top:50%; left:0; width:100%; height:2px; }
.vertical-line { top:0; left:50%; width:2px; height:100%; }
.split-area { position:absolute; width:50%; height:50%; overflow:hidden; }
.split-area.top-left { top:0; left:0; }
.split-area.bottom-left { bottom:0; left:0; }
.split-area.top-right { top:0; right:0; }
.split-area.bottom-right { bottom:0; right:0; }
.button-group {
  position:absolute; bottom:5px; left:5px; z-index:2;
  display:flex; gap:5px;
}
.button-group button {
  padding:4px 8px; font-size:14px; cursor:pointer; transition:transform 0.2s;
}
.button-group button:hover { transform:scale(1.1); background:#444; }

/* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å®šç¾© */
@keyframes fadeEffect {0%{opacity:0;}100%{opacity:1;}}
@keyframes zoomEffect {0%{transform:scale(0.8);opacity:0;}100%{transform:scale(1);opacity:1;}}
@keyframes slideEffect {0%{transform:translateX(-100%);opacity:0;}100%{transform:translateX(0);opacity:1;}}
@keyframes rotateEffect {0%{transform:rotate(-180deg);opacity:0;}100%{transform:rotate(0);opacity:1;}}
</style>
</head>

<body>
<h1>ãƒ‡ãƒã‚¤ã‚¹æ¥ç¶š</h1>
<select id="screenCaptureSelect">
  <option value="1">ç”»é¢1</option>
  <option value="2">ç”»é¢2</option>
  <option value="3">ç”»é¢3</option>
  <option value="4">ç”»é¢4</option>
  <option value="5">ç”»é¢5</option>
  <option value="6">ç”»é¢6</option>
  <option value="7">ç”»é¢7</option>
</select>
<button id="startScreenCaptureButton">ç”»é¢ã‚­ãƒ£ãƒ—ãƒãƒ£</button>
<button id="startCameraButton">ã‚«ãƒ¡ãƒ©</button>
<button id="openLiveWindowBtn">ğŸ¬ LIVEæ“ä½œï¼ˆåˆ¥ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ï¼‰</button>

<div class="container">
  <div class="cell"><div class="label">å‡ºåŠ›</div><video id="switchVideo1" autoplay playsinline></video></div>

  <!-- å³ä¸Šï¼šç”»é¢3 -->
  <div class="cell">
    <div class="label">ç”»é¢3</div>
    <div class="horizontal-line"></div><div class="vertical-line"></div>
    <div class="split-area top-left"><video id="captureVideo1" autoplay playsinline></video></div>
    <div class="split-area bottom-left"><video id="captureVideo2" autoplay playsinline></video></div>
    <div class="split-area top-right"><video id="captureVideo3" autoplay playsinline></video></div>
    <div class="split-area bottom-right"><video id="captureVideo4" autoplay playsinline></video></div>
  </div>

  <!-- å·¦ä¸‹ï¼šç”»é¢4 -->
  <div class="cell">
    <div class="label">ç”»é¢4</div>
    <div class="horizontal-line"></div><div class="vertical-line"></div>
    <div class="split-area top-left"><video id="captureVideo5" autoplay playsinline></video></div>
    <div class="split-area bottom-left"><video id="captureVideo6" autoplay playsinline></video></div>
    <div class="split-area top-right"><video id="captureVideo7" autoplay playsinline></video></div>
    <div class="split-area bottom-right"><video id="cameraVideo" autoplay playsinline></video></div>
    <div class="button-group">
      <button onclick="switchSource(5)">5</button>
      <button onclick="switchSource(6)">6</button>
      <button onclick="switchSource(7)">7</button>
      <button onclick="switchSource('camera')">8</button>
    </div>
  </div>

  <div class="cell"><div class="label">äºˆå‚™</div><video id="previewVideo" autoplay playsinline muted></video></div>
</div>

<script>
const videoElements = {
  1: captureVideo1, 2: captureVideo2, 3: captureVideo3, 4: captureVideo4,
  5: captureVideo5, 6: captureVideo6, 7: captureVideo7, camera: cameraVideo
};
const switchVideo = document.getElementById("switchVideo1");
const previewVideo = document.getElementById("previewVideo");
let liveWindow = null;
let liveAnimType = 'fadeEffect';
let liveAnimSpeed = '1s';

// ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å†ç”Ÿé–¢æ•°ï¼ˆå·¦ä¸Šã®ã¿ï¼‰
function playAnim(el, type, speed) {
  el.style.animation = 'none';
  void el.offsetWidth;
  el.style.animation = `${type} ${speed} ease`;
}

// å‡ºåŠ›åˆ‡æ›¿
function switchSource(id) {
  const srcVideo = videoElements[id];
  if (!srcVideo || !srcVideo.srcObject) return;

  // ãƒ¡ã‚¤ãƒ³ç”»é¢åˆ‡æ›¿
  switchVideo.srcObject = srcVideo.srcObject;
  previewVideo.srcObject = srcVideo.srcObject;
  playAnim(switchVideo, liveAnimType, liveAnimSpeed);

  if (liveWindow && !liveWindow.closed) {
    // å·¦ä¸Šï¼ˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ä»˜ãï¼‰
    const liveLeftTop = liveWindow.document.getElementById("liveCaptureVideo1");
    if (liveLeftTop) {
      liveLeftTop.srcObject = srcVideo.srcObject;
      playAnim(liveLeftTop, liveAnimType, liveAnimSpeed);
    }

    // å³ä¸Š ç”»é¢3 4åˆ†å‰²ï¼ˆã‚¢ãƒ‹ãƒ¡ãªã—ï¼‰
    ['liveRU1','liveRU2','liveRU3','liveRU4'].forEach((liveId,i)=>{
      const mainId = ['captureVideo1','captureVideo2','captureVideo3','captureVideo4'][i];
      const mainVid = document.getElementById(mainId);
      const liveVid = liveWindow.document.getElementById(liveId);
      if (mainVid && mainVid.srcObject) liveVid.srcObject = mainVid.srcObject;
    });

    // å·¦ä¸‹ ç”»é¢4 4åˆ†å‰²ï¼ˆã‚¢ãƒ‹ãƒ¡ãªã—ï¼‰
    ['liveLD1','liveLD2','liveLD3','liveLD4'].forEach((liveId,i)=>{
      const mainId = ['captureVideo5','captureVideo6','captureVideo7','cameraVideo'][i];
      const mainVid = document.getElementById(mainId);
      const liveVid = liveWindow.document.getElementById(liveId);
      if (mainVid && mainVid.srcObject) liveVid.srcObject = mainVid.srcObject;
    });

    // å³ä¸‹ï¼ˆäºˆå‚™ï¼‰ã‚¢ãƒ‹ãƒ¡ãªã—
    const liveRD = liveWindow.document.getElementById("liveRD1");
    if (previewVideo.srcObject) liveRD.srcObject = previewVideo.srcObject;
  }
}

// ã‚­ãƒ£ãƒ—ãƒãƒ£ãƒ»ã‚«ãƒ¡ãƒ©èµ·å‹•
startScreenCaptureButton.onclick = () => {
  const id = screenCaptureSelect.value;
  const v = videoElements[id];
  if (v)
    navigator.mediaDevices.getDisplayMedia({video:true})
    .then(s => v.srcObject = s)
    .catch(console.error);
};
startCameraButton.onclick = () => {
  navigator.mediaDevices.getUserMedia({video:true})
  .then(s => videoElements.camera.srcObject = s)
  .catch(console.error);
};

// LIVEã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ç”Ÿæˆ
openLiveWindowBtn.onclick = () => {
  liveWindow = window.open("", "livePanel", "width=1280,height=800");
  if (!liveWindow) return alert("ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’è¨±å¯ã—ã¦ãã ã•ã„");

  liveWindow.document.title = "ğŸ¬ LIVEæ“ä½œãƒ‘ãƒãƒ«";
  liveWindow.document.body.style.background = "black";
  liveWindow.document.body.style.color = "white";
  liveWindow.document.body.style.fontFamily = "sans-serif";
  liveWindow.document.body.innerHTML = `
    <h3 style="text-align:center;">ğŸ¬ LIVEæ“ä½œãƒ‘ãƒãƒ«</h3>
    <div style="text-align:center;margin:10px;">
      ${[1,2,3,4,5,6,7,'camera'].map(i=>`<button data-id="${i}">åˆ‡æ›¿${i}</button>`).join('')}
    </div>
    <div style="text-align:center;margin:10px;">
      <label>ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³:
        <select id="animType">
          <option value="fadeEffect">ãƒ•ã‚§ãƒ¼ãƒ‰</option>
          <option value="zoomEffect">ã‚ºãƒ¼ãƒ </option>
          <option value="slideEffect">ã‚¹ãƒ©ã‚¤ãƒ‰</option>
          <option value="rotateEffect">å›è»¢</option>
        </select>
      </label>
      <label>é€Ÿåº¦:
        <select id="animSpeed">
          <option value="0.5s">0.5ç§’</option>
          <option value="1s" selected>1ç§’</option>
          <option value="2s">2ç§’</option>
        </select>
      </label>
    </div>

    <div style="position:relative;width:90%;height:500px;margin:20px auto;border:3px solid white;">
      <!-- å·¦ä¸Šï¼šãƒ¡ã‚¤ãƒ³å‡ºåŠ›ï¼ˆã‚¢ãƒ‹ãƒ¡æœ‰ã‚Šï¼‰ -->
      <div style="position:absolute;top:0;left:0;width:50%;height:50%;border:1px solid white;">
        <video id="liveCaptureVideo1" autoplay muted style="width:100%;height:100%;object-fit:cover;"></video>
      </div>

      <!-- å³ä¸Šï¼šç”»é¢3 4åˆ†å‰²ï¼ˆã‚¢ãƒ‹ãƒ¡ãªã—ï¼‰ -->
      <div style="position:absolute;top:0;right:0;width:50%;height:50%;border:1px solid white;">
        <div style="position:absolute;top:50%;left:0;width:100%;height:2px;background:white;"></div>
        <div style="position:absolute;top:0;left:50%;width:2px;height:100%;background:white;"></div>
        ${[1,2,3,4].map(i=>`
          <div class="mini" style="position:absolute;${i<3?'top:0':'bottom:0'};${i%2==1?'left:0':'right:0'};width:50%;height:50%;">
            <video id="liveRU${i}" autoplay muted style="width:100%;height:100%;object-fit:cover;"></video>
          </div>`).join('')}
      </div>

      <!-- å·¦ä¸‹ï¼šç”»é¢4 4åˆ†å‰²ï¼ˆã‚¢ãƒ‹ãƒ¡ãªã—ï¼‰ -->
      <div style="position:absolute;bottom:0;left:0;width:50%;height:50%;border:1px solid white;">
        <div style="position:absolute;top:50%;left:0;width:100%;height:2px;background:white;"></div>
        <div style="position:absolute;top:0;left:50%;width:2px;height:100%;background:white;"></div>
        ${[1,2,3,4].map(i=>`
          <div class="mini" style="position:absolute;${i<3?'top:0':'bottom:0'};${i%2==1?'left:0':'right:0'};width:50%;height:50%;">
            <video id="liveLD${i}" autoplay muted style="width:100%;height:100%;object-fit:cover;"></video>
          </div>`).join('')}
      </div>

      <!-- å³ä¸‹ï¼šäºˆå‚™ï¼ˆã‚¢ãƒ‹ãƒ¡ãªã—ï¼‰ -->
      <div style="position:absolute;bottom:0;right:0;width:50%;height:50%;border:1px solid white;">
        <video id="liveRD1" autoplay muted style="width:100%;height:100%;object-fit:cover;"></video>
      </div>
    </div>

    <style>
      @keyframes fadeEffect {0%{opacity:0;}100%{opacity:1;}}
      @keyframes zoomEffect {0%{transform:scale(0.8);opacity:0;}100%{transform:scale(1);opacity:1;}}
      @keyframes slideEffect {0%{transform:translateX(-100%);opacity:0;}100%{transform:translateX(0);opacity:1;}}
      @keyframes rotateEffect {0%{transform:rotate(-180deg);opacity:0;}100%{transform:rotate(0);opacity:1;}}
    </style>
  `;

  // è¨­å®šåŒæœŸ
  const typeSel = liveWindow.document.getElementById("animType");
  const speedSel = liveWindow.document.getElementById("animSpeed");
  typeSel.onchange = () => liveAnimType = typeSel.value;
  speedSel.onchange = () => liveAnimSpeed = speedSel.value;

  // LIVEãƒœã‚¿ãƒ³åŒæœŸ
  liveWindow.document.querySelectorAll("button[data-id]").forEach(btn=>{
    btn.onclick = () => switchSource(btn.dataset.id);
  });

  // åˆæœŸæ˜ åƒåŒæœŸ
  const liveLeftTop = liveWindow.document.getElementById("liveCaptureVideo1");
  if (switchVideo.srcObject) liveLeftTop.srcObject = switchVideo.srcObject;

  ['captureVideo1','captureVideo2','captureVideo3','captureVideo4'].forEach((id,i)=>{
    const mainVid = document.getElementById(id);
    const liveVid = liveWindow.document.getElementById(`liveRU${i+1}`);
    if (mainVid.srcObject) liveVid.srcObject = mainVid.srcObject;
  });

  ['captureVideo5','captureVideo6','captureVideo7','cameraVideo'].forEach((id,i)=>{
    const mainVid = document.getElementById(id);
    const liveVid = liveWindow.document.getElementById(`liveLD${i+1}`);
    if (mainVid.srcObject) liveVid.srcObject = mainVid.srcObject;
  });

  const liveRD = liveWindow.document.getElementById("liveRD1");
  if (previewVideo.srcObject) liveRD.srcObject = previewVideo.srcObject;
};
</script>
</body>
</html>
